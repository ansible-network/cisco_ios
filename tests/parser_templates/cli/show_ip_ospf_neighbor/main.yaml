---

### OSPF not active

- name: not active - parse `show ip ospf neighbor`
  command_parser:
    file: "{{ playbook_dir }}/../parser_templates/cli/show_ip_ospf_neighbor.yaml"
    content: "{{ lookup('file', '{{ playbook_dir }}/parser_templates/cli/show_ip_ospf_neighbor/ospf_not_active.txt') }}"
  register: result

- name: not active - test `show ip ospf neighbor` parser
  assert:
    that:
      - cisco_ios.ospf['process_state'] == 'not active'

- name: clear facts
  meta: clear_facts

### IOS 15.4(3r)M1.txt

- name: 15.4(3r)M1.txt - parse `show ip ospf neighbor`
  command_parser:
    file: "{{ playbook_dir }}/../parser_templates/cli/show_ip_ospf_neighbor.yaml"
    content: "{{ lookup('file', '{{ playbook_dir }}/parser_templates/cli/show_ip_ospf_neighbor/15.4(3r)M1.txt') }}"
  register: result

- name: 15.4(3r)M1.txt - test `show ip ospf neighbor` parser
  assert:
    that:
      - "'130.200.191.21' in cisco_ios.ospf['neighbors']"
      - cisco_ios.ospf['neighbors']['130.200.191.21']['neighbor_id'] == 'ansi06a1.redhat'
      - cisco_ios.ospf['neighbors']['130.200.191.21']['state'] == 'FULL'
      - cisco_ios.ospf['neighbors']['130.200.191.21']['role'] == '-'
      - cisco_ios.ospf['neighbors']['130.200.191.21']['timer'] == '00:00:37'
      - cisco_ios.ospf['neighbors']['130.200.191.21']['interface'] == 'Tunnel821'

### Done

- name: all tests complete
  debug:
    msg: "All tests for `show ip ospf summary` passed"
